This grails app uses both the [spring security](1) abd [springe security rest](2) plugin.  This is a protoype for an authorization service.

# TO USE
run `grails run-app`  

POST to http://localhost:9090/grails-auth-service/api/login with login credentials in the body:
```
{ "username" : "adeady", "password" : "password" }
```
You should get a response with a token:
```
{
  "username": "adeady",
  "roles": [
    "ROLE_USER"
  ],
  "token_type": "Bearer",
  "access_token": "eyJhbGciOiJIUzI1NiJ9.eyJwcmluY2lwYWwiOiJINHNJQUFBQUFBQUFBSlZTUDBcL2JRQlJcL1RrT2hpdFFDVWlzeDBBWFlrQ08xWTVZQ1Npc2hDNnFFTEVFQ1hleUhlM0MrTTNkblNCYVVxUjBZcUtDUkt2VXI4RTNhaFErQVlHQmw3dHAzaHVDMEMrcE45cnVmZlwvK2V6MjloekdoNEcydkdoZkZUa2NWYytpYlZYTVlHdzB4ejJcL016Z3pwQ215TSs1TUFXVGVEdWVDWHdBaWp4eU1KMHNNc09XRlV3R1ZmWE83c1kybHBYd3h1bDQzdkdIYzBTUEZSNnozXC9nRHBYR3Z3UUthdTlkQ2NiYk1NWENVR1hTcmlsWjc2WmNZOVNHeVdJV3FIRFBqVjZHZElQU2NpYk1LSFFjSmVzSWpBS29zTXgrVXFUSzBWaDRjV2MyczF4VW0yaHJBVXlrekJoeTkwK1NwblhXM2IyektTbkJQaHhCdVp0NmRLaTdCUWYxSFkrXC9vb1NnMUZ4Sk05K1NpWXI0RG5maXhOK2ZQYjA0K2RGdmxRQ29rOFhIdnlubU04dlFcLzduMSszVmV0QmRhZURWaXZZRFZ1aW01bVNxWU56UTY1Y3Z2SDg4R3QxODJuNUN5UTd6XC9cLzMzTUw5MDMxMXRSU2NvMHMycGtSMFI3V0hiUFJMNzhPUGx3Q3oyXC95Wk5VSVAxUjBtTDBJRkVRVTl5eVZtTFl0NFZuamZXZ3Z0MXExaHZ1N1NtTGtFVTlVbjJlaDNiYjhnTkZ1enErK2ZyclpPNktHRlpoN0lDSkRLbnp5UUswbGlVZDFKXC9QQjdPVmI5ZkhlWUxoM1wvd0h2UTBQbVJFREFBQT0iLCJzdWIiOiJhZGVhZHkiLCJleHAiOjE0NDQwNTUxNjMsImlhdCI6MTQ0NDA1MTU2Mywicm9sZXMiOlsiUk9MRV9VU0VSIl19.n4Xo7c8MjckJJUakX2-8Gub_CaDMrOIRaz4ati2Oe14",
  "expires_in": 3600,
  "refresh_token": "eyJhbGciOiJIUzI1NiJ9.eyJwcmluY2lwYWwiOiJINHNJQUFBQUFBQUFBSlZTUDBcL2JRQlJcL1RrT2hpdFFDVWlzeDBBWFlrQ08xWTVZQ1Npc2hDNnFFTEVFQ1hleUhlM0MrTTNkblNCYVVxUjBZcUtDUkt2VXI4RTNhaFErQVlHQmw3dHAzaHVDMEMrcE45cnVmZlwvK2V6MjloekdoNEcydkdoZkZUa2NWYytpYlZYTVlHdzB4ejJcL016Z3pwQ215TSs1TUFXVGVEdWVDWHdBaWp4eU1KMHNNc09XRlV3R1ZmWE83c1kybHBYd3h1bDQzdkdIYzBTUEZSNnozXC9nRHBYR3Z3UUthdTlkQ2NiYk1NWENVR1hTcmlsWjc2WmNZOVNHeVdJV3FIRFBqVjZHZElQU2NpYk1LSFFjSmVzSWpBS29zTXgrVXFUSzBWaDRjV2MyczF4VW0yaHJBVXlrekJoeTkwK1NwblhXM2IyektTbkJQaHhCdVp0NmRLaTdCUWYxSFkrXC9vb1NnMUZ4Sk05K1NpWXI0RG5maXhOK2ZQYjA0K2RGdmxRQ29rOFhIdnlubU04dlFcLzduMSszVmV0QmRhZURWaXZZRFZ1aW01bVNxWU56UTY1Y3Z2SDg4R3QxODJuNUN5UTd6XC9cLzMzTUw5MDMxMXRSU2NvMHMycGtSMFI3V0hiUFJMNzhPUGx3Q3oyXC95Wk5VSVAxUjBtTDBJRkVRVTl5eVZtTFl0NFZuamZXZ3Z0MXExaHZ1N1NtTGtFVTlVbjJlaDNiYjhnTkZ1enErK2ZyclpPNktHRlpoN0lDSkRLbnp5UUswbGlVZDFKXC9QQjdPVmI5ZkhlWUxoM1wvd0h2UTBQbVJFREFBQT0iLCJzdWIiOiJhZGVhZHkiLCJpYXQiOjE0NDQwNTE1NjQsInJvbGVzIjpbIlJPTEVfVVNFUiJdfQ.wAOLAw6HYM1DQ1pUAL71mtSEDGS6bgdOXE6oiwh9MBY"
}
```
Copy the `access_token` somewhere.  
Validate the token at: http://localhost:9090/grails-auth-service/api/validate With an Authorization header with the following value:
`Authorization: Bearer <token copied from the POST above`
e.g. `Authorization Bearer eyJhbGciOiJIUzI1NiJ9.eyJwcmluY2lwYWwiOiJINHNJQUFBQUFBQUFBSlZTUDBcL2JRQlJcL1RrT2hpdFFDVWlzeDBBWFlrQ08xWTVZQ1Npc2hDNnFFTEVFQ1hleUhlM0MrTTNkblNCYVVxUjBZcUtDUkt2VXI4RTNhaFErQVlHQmw3dHAzaHVDMEMrcE45cnVmZlwvK2V6MjloekdoNEcydkdoZkZUa2NWYytpYlZYTVlHdzB4ejJcL016Z3pwQ215TSs1TUFXVGVEdWVDWHdBaWp4eU1KMHNNc09XRlV3R1ZmWE83c1kybHBYd3h1bDQzdkdIYzBTUEZSNnozXC9nRHBYR3Z3UUthdTlkQ2NiYk1NWENVR1hTcmlsWjc2WmNZOVNHeVdJV3FIRFBqVjZHZElQU2NpYk1LSFFjSmVzSWpBS29zTXgrVXFUSzBWaDRjV2MyczF4VW0yaHJBVXlrekJoeTkwK1NwblhXM2IyektTbkJQaHhCdVp0NmRLaTdCUWYxSFkrXC9vb1NnMUZ4Sk05K1NpWXI0RG5maXhOK2ZQYjA0K2RGdmxRQ29rOFhIdnlubU04dlFcLzduMSszVmV0QmRhZURWaXZZRFZ1aW01bVNxWU56UTY1Y3Z2SDg4R3QxODJuNUN5UTd6XC9cLzMzTUw5MDMxMXRSU2NvMHMycGtSMFI3V0hiUFJMNzhPUGx3Q3oyXC95Wk5VSVAxUjBtTDBJRkVRVTl5eVZtTFl0NFZuamZXZ3Z0MXExaHZ1N1NtTGtFVTlVbjJlaDNiYjhnTkZ1enErK2ZyclpPNktHRlpoN0lDSkRLbnp5UUswbGlVZDFKXC9QQjdPVmI5ZkhlWUxoM1wvd0h2UTBQbVJFREFBQT0iLCJzdWIiOiJhZGVhZHkiLCJleHAiOjE0NDQwNTUxNjMsImlhdCI6MTQ0NDA1MTU2Mywicm9sZXMiOlsiUk9MRV9VU0VSIl19.n4Xo7c8MjckJJUakX2-8Gub_CaDMrOIRaz4ati2Oe14`

Navigate to the protected resource: http://localhost:9090/grails-auth-service/api/protectedResource/index with the same Authorization token as before.
You should see:
```
[
  {
    "class": "grails.auth.service.ProtectedResource",
    "id": 1,
    "description": "bar",
    "name": "foo"
  },
  ...
```

## Learnings 
The spring-security-rest plugin only works on grails rest controllers.  Setting up a basic /api filter on a normal controller does not work.
